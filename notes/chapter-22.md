# internet security protocols

### mime

- extension to old rfc 822 spec of internet mail format
  - rfc 822 defines a simple heading with to, from, subject
  - assumes ascii
- provides number of new header fields that define info about body of message

### s/mime

- secure/multipurpose internet mail extension
- security enhancement to mime internet email format
  - based on tech from rsa data security
- provides ability to sign and/or encrypt emails

### s/mime functions

- enveloped data
  - encrypted content & associated keys
- signed data
  - encoded message & signed digest
- clear-signed data
  - cleartext message & encoded signed digest
- signed & enveloped data
  - nesting of signed & encrypted entities

### signed & clear-signed data

- preferred algorithms for signing s/mime emails use either rsa or dsa signature of sha256 message hash
- process outline
  - use sha256 to map message
  - 256-bit message digest is unique for this message, making it virtually impossible for someone to alter or substitute & still come up with same digest
  - s/mime encrypts digest using rsa & sender's private rsa key
  - result is digital signature attached to message
  - anyone who gets message can recompute then decrypt signature using rsa & sender's public rsa key

### enveloped data

- default algorithms used for encrypting s/mime emails are aes & rsa
  - s/mime generates pseudorandom secret key used to encrypt message using aes or some other conventionmal encryption scheme
  - new pseudorandom key generated for each new message encryption
  - session key bound to message & transmitted with it
  - secret key used as input to public-key encryption algorithm, rsa, which encrypts key with recipient's public rsa key
  - on receiving end, s/mime uses receiver's private rsa key to recover secret key, then uses secret key & aes to recover plaintext message
  - if encryption used alone, base64 used to convert ciphertext to ascii format

### domainkeys identified mail (dkim)

- specification of cryptographically signing emails permitting a signing domain to claim responsibility for message in mail stream
- proposed internet standard - rfc 4871: domainkeys identified mail (dkim) signatures
- has been widely adopted by range of email providers

### secure sockets layer (ssl) & transport layer security (tls)

- one of most widely used security services
- general-purpose service implemented as set of protocols that rely on tcp
- subsequently became internet standard rfc4346: tls
- 2 implementation choices
  - part of underlying protocol suite
  - embedded in specific packages

### tls concepts

- tls session
  - association between client & server
  - created by handshake protocol
  - define a set of cryptographic security params
  - used to avoid expensive negotiation of new security params for each connection
- tls connection
  - transport (in osi layering model definition) that provides a suitable type of service
  - peer-to-peer relationships
  - transient
  - every connection associated with one session

### change cipher spec protocol

- 1 of 4 tls specific protocols that use tls record protocol
- simplest
- consists of single-byte message with value 1
- sole purpose of message is to cause pending state to be copied into current state
- hence updating cipher suite in use

### alert protocol

- conveys tls-related alerts to peer entity
- alert messages compressed & encrypted
- message consists of 2 bytes
  - 1st byte takes value warning (1) or fatal (2) to convey severity of message
    - if level fatal, tls immediately terminates
    - other connections on same session may continue, but no new connections on this session may be established
  - 2nd byte contains code that indicates specific alert

### handshake protocol

- most complex part of tls
- used before any app data transmitted
- allows server & client to
  - authenticate each other
  - negotiate encryption & mac algorithms
  - negotiate cryptographic keys to be used
- comprises of series of message exchanged by client & server
- 4 phases of exchange
  - establish security capabilities, including protocol version, session id, cipher suite, compression method, & initial random numbers
  - server may send cert, key exchange, & request cert. server signals end of hello message phase
  - client sends cert if requested. client sends key exchange. client may send cert verification
  - change cipher suite & finish handshake protocol

### heartbeat protocol

- periodic signal generated by hardware or software to indicate normal operation or to sync other parts of system
- typically used to monitor availability of protocol entity
- defined in 2012 by rfc 6250
- runs on top of tls record protocol
- use established during phase 1 of handshake protocol
- each peer indicates whether it supports heartbeats
- serves 2 purposes
  - assures sender that recipient still alive
  - generates activity across connection during idle periods

### ssl/tls attacks

- 4 general categories
  - attacks on handshake protocol
  - attacks on record & app data protocols
  - attacks on pki
  - other attacks

### https (http over ssl)

- combination of http & ssl to implement secure comms between web server & browser
- built into all modern web browsers
  - search engines don't support https
  - url addresses begin with `https://`
- documented in rfc 2818, http over tls
- agent acting as http client also acts as tls client
- closure of https connection requires that tls close connection with peer tls entity on remote side, which will involve closing underlying tcp connection

### ip security (ipsec)

- various app security mechanisms
  - s/mime, kerberos, ssl/https
- security concerns cross protocol layers
- would like security implemented by network for all apps
- auth & encryption security features included in ipv6
- also usable in ipv4

### benefits of ipsec

- when implemented in firewall or router, it provides strong security to all traffic crossing perimeter
- in firewall, resistant to bypass
- below transport layer, hence transparent to apps
- can be transparent to end users
- can provide security for individual users
- secures routing architecture

### scope of ipsec

- provides 2 main functions
  - combined authentication/encryption function called encapsulating security payload (esp)
  - key exchange function
  - also authentication-only function implemented using authentication header (ah)
    - because message authentication provided by esp, use of ah included in ipsecv3 for backward compatibility but should not be used in new apps
- vpns want both authentication & encryption
- spec quite complex
  - numerous rfc's: 2401, 4302, 4303, 4306

### security associations

- one-way relationship between sender & receiver that affords security for traffic flow
  - if peer relationship needed for 2-way secure exchange, then 2 security associations required
- is uniquely identified to destination addr in ipv4/v6 header & spi in enclosed extension header (ah or esp)
- defined by 3 params
  - security param index (spi)
  - ip destination addr
  - protocol identifier

### transport & tunnel modes

- transport mode
  - extends to payload of ip packet
  - typically used for end-to-end comms between 2 hosts
  - esp encrypts & optionally authenticates ip payload but not ip header
- tunnel mode
  - provides protection to entire ip packet
  - entire original packet travles through tunnel from 1 point of ip network to another
  - used when 1 or both ends of security association are security gateway
  - a number of hosts on networks behind firewalls may engage in secure comms without implementing ipsec
